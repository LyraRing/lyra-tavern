---
title: ã€Luaé­”æ³•æ‰‹å†Œã€‘ä»æœˆäº®åˆ°çƒ­æ›´æ–°ï¼šæ¸¸æˆç¨‹åºå‘˜çš„ç‘å£«å†›åˆ€ä¿®ç‚¼æŒ‡å—
date: 2024/3/7 00:01:01
categories: 
  - ["Unity3D",]
  - ["Lua","LuaåŸºç¡€è¯­æ³•"]
tags: ["è®¡ç®—æœº","æ¸¸æˆå¼€å‘","æ¸¸æˆçƒ­æ›´æ–°"]
description: æœ¬ç¯‡æ–‡ç« ä¸»è¦è®²è§£Luaçš„åŸºç¡€å†…å®¹ï¼Œä¸ºUnityçš„çƒ­æ›´æ–°ç³»åˆ—çš„åŸºç¡€ä¹‹ä¸€ã€‚
---

> **æ¸©é¦¨æç¤º**ï¼šå­¦Luaå°±åƒå­¦éª‘è‡ªè¡Œè½¦ï¼Œä¸€å¼€å§‹å¯èƒ½ä¼šæ‘”å‡ ä¸ªè·Ÿå¤´ï¼Œä½†ä¸€æ—¦æŒæ¡äº†å¹³è¡¡ï¼Œä½ å°±èƒ½åœ¨æ¸¸æˆå¼€å‘çš„ä¸–ç•Œé‡Œè‡ªç”±é©°éª‹ï¼

# ğŸŒ™ ç¬¬ä¸€ç« ï¼šæœˆäº®å‡èµ· - Luaçš„å‰ä¸–ä»Šç”Ÿä¸æ±Ÿæ¹–åœ°ä½

Luaï¼ˆè‘¡è„ç‰™è¯­æ„ä¸º"æœˆäº®"ï¼‰è¯ç”Ÿäº1993å¹´çš„å·´è¥¿ï¼Œåƒä¸€é¢—å—åŠçƒçš„æ˜Ÿè¾°ï¼Œç…§äº®äº†åµŒå…¥å¼è„šæœ¬è¯­è¨€çš„å¤œç©ºã€‚å®ƒä¸æ˜¯æœ€äº®çš„æ˜Ÿï¼Œå´æ˜¯æœ€çµæ´»çš„é‚£ä¸€é¢—â€”â€”è½»é‡çº§ï¼ˆæ•´ä¸ªè§£é‡Šå™¨ä»…200-300KBï¼‰ã€å¯åµŒå…¥ã€é«˜æ•ˆèƒ½ï¼Œç®€ç›´å°±æ˜¯ç¼–ç¨‹ç•Œçš„ç‘å£«å†›åˆ€ï¼

åœ¨æ¸¸æˆå¼€å‘çš„æ±Ÿæ¹–é‡Œï¼ŒLuaçš„åœ°ä½å ªæ¯”"å¹•åé»‘æ‰‹"â€”â€”ä½ çœ‹ä¸åˆ°å®ƒï¼Œä½†å®ƒæŒæ§ç€ä¸€åˆ‡ã€‚ç‰¹åˆ«æ˜¯Unityçƒ­æ›´æ–°é¢†åŸŸï¼ŒLuaç®€ç›´å°±æ˜¯ç¨‹åºå‘˜çš„"åæ‚”è¯"ï¼šä¸ç”¨é‡æ–°æ‰“åŒ…æ¸¸æˆï¼Œå°±èƒ½ä¿®å¤é‚£äº›è®©ä½ å¤œä¸èƒ½å¯çš„bugï¼Œæ·»åŠ è®©ç©å®¶å°–å«çš„æ–°åŠŸèƒ½ã€‚å½“äº§å“ç»ç†åœ¨å‘¨äº”ä¸‹åˆ5:59è¯´"æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå°æ”¹åŠ¨"æ—¶ï¼ŒLuaå°±æ˜¯ä½ å¾®ç¬‘é¢å¯¹å‘¨æœ«çš„åº•æ°”ã€‚

## 1.1 Lua vs å…¶ä»–è¯­è¨€ï¼šä¸ºä½•é€‰æ‹©è¿™ä¸ªå°æœˆäº®ï¼Ÿ

- **C#**ï¼šå¼ºå¤§ä½†ä¸å¤Ÿçµæ´»ï¼Œçƒ­æ›´æ–°åƒç»™è¡Œé©¶ä¸­çš„æ±½è½¦æ¢è½®èƒ
- **JavaScript**ï¼šWebé¢†åŸŸçš„ç‹è€…ï¼Œä½†åœ¨æ¸¸æˆæ€§èƒ½æ–¹é¢ç•¥æ˜¾ç–²è½¯
- **Python**ï¼šåŠŸèƒ½ä¸°å¯Œä½†ä½“ç§¯åºå¤§ï¼Œä¸é€‚åˆèµ„æºå—é™çš„ç§»åŠ¨è®¾å¤‡
- **Lua**ï¼šè½»å¦‚é¸¿æ¯›ï¼ŒéŸ§å¦‚è’²è‰ï¼Œå®Œç¾å¹³è¡¡æ€§èƒ½ä¸çµæ´»æ€§

è®°ä½ï¼š**Luaä¸æ˜¯ç”¨æ¥å†™å¤§å‹ç¨‹åºçš„è¯­è¨€ï¼Œè€Œæ˜¯è®©å¤§å‹ç¨‹åºå˜å¾—æ›´å°çš„è¯­è¨€ã€‚** â€”â€” Luaä¹‹çˆ¶Roberto Ierusalimschy

# ğŸ’» ç¬¬äºŒç« ï¼šé­”æ³•å…¥é—¨ - å˜é‡ã€æ³¨é‡Šä¸åŸºç¡€ç±»å‹

## 2.1 é­”æ³•å¯ç¨‹ï¼šä½ çš„ç¬¬ä¸€ä¸ªLuaå’’è¯­

```lua
print("Hello, moon!")
```

ç§ç§ï¼Œå¤šä¹ˆç®€æ´ï¼Luaè¯­å¥ç»“å°¾çš„åˆ†å·ï¼ˆ`;`ï¼‰æ˜¯å¯é€‰çš„ï¼Œå°±åƒç‰›ä»”è£¤ä¸Šçš„ç ´æ´â€”â€”æœ‰å®ƒæ²¡å®ƒéƒ½èƒ½ç©¿ï¼Œä½†å¤§å¤šæ•°Luaè€æ‰‹éƒ½é€‰æ‹©çœç•¥å®ƒï¼Œå› ä¸ºç®€æ´å³æ˜¯ç¾ã€‚

## 2.2 æ³¨é‡Šï¼šå†™ç»™æœªæ¥è‡ªå·±çš„æƒ…ä¹¦

å¥½çš„ä»£ç æ˜¯è‡ªè§£é‡Šçš„ï¼Œä½†å¥½çš„æ³¨é‡Šæ˜¯ç»™æœªæ¥é‚£ä¸ªå¿˜è®°è‡ªå·±å†™äº†ä»€ä¹ˆçš„ä½ å‡†å¤‡çš„ã€‚Luaæä¾›ä¸¤ç§æ³¨é‡Šæ–¹å¼ï¼š

```lua
-- æˆ‘æ˜¯å•è¡Œæ³¨é‡Šï¼Œåƒä¸€æ¯æµ“ç¼©ç¾å¼ï¼Œç®€å•ç›´æ¥

--[[
    æˆ‘æ˜¯å¤šè¡Œæ³¨é‡Š
    å¯ä»¥å†™å¾ˆå¤šå¾ˆå¤šå­—
    ç”šè‡³å¯ä»¥å†™ä¸€é¦–è¯—ï¼š
    åºŠå‰æ˜æœˆå…‰
    ç–‘æ˜¯åœ°ä¸Šéœœ
    ä¸¾å¤´æœ›æ˜æœˆ
    ä½å¤´å†™ä»£ç 
]]
```

> **é­”æ³•è´´å£«**ï¼šå¤šè¡Œæ³¨é‡Šå¯ä»¥åµŒå¥—ï¼Œä½†è¯·å°å¿ƒï¼å°±åƒä¿„ç½—æ–¯å¥—å¨ƒï¼Œä¸€ä¸å°å¿ƒå°±ä¼šæŠŠè‡ªå·±å¥—è¿›å»å‡ºä¸æ¥ï¼

## 2.3 å˜é‡ç±»å‹ï¼šLuaçš„å…«ç§é­”æ³•å…ƒç´ 

Luaæ˜¯å¼±ç±»å‹è¯­è¨€ï¼Œå˜é‡ç±»å‹ä¼šæ ¹æ®èµ‹å€¼è‡ªåŠ¨æ¨æ–­ã€‚å®ƒæœ‰8ç§åŸºæœ¬ç±»å‹ï¼š

| ç±»å‹     | è¯´æ˜                               | ç±»æ¯”                               |
| -------- | ---------------------------------- | ---------------------------------- |
| nil      | è¡¨ç¤ºç©ºå€¼ï¼Œæ˜¯æ‰€æœ‰æœªå®šä¹‰å˜é‡çš„é»˜è®¤å€¼ | å°±åƒçœŸç©ºï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ä½†åˆæœ‰æ— é™å¯èƒ½ |
| number   | è¡¨ç¤ºæ•°å­—ï¼ŒåŒ…å«æ•´æ•°å’Œæµ®ç‚¹æ•°         | ç²¾ç¡®çš„æ•°å­¦ç²¾çµ                     |
| string   | è¡¨ç¤ºå­—ç¬¦ä¸²                         | æ–‡å­—çš„èˆè€…                         |
| boolean  | è¡¨ç¤ºå¸ƒå°”ç±»å‹ï¼ˆtrue/falseï¼‰         | éé»‘å³ç™½çš„å†³ç­–è€…                   |
| table    | è¡¨ä¸‡èƒ½æ•°æ®ç»“æ„                     | å˜å½¢é‡‘åˆšï¼Œèƒ½å˜æˆä»»ä½•ä½ éœ€è¦çš„å½¢çŠ¶   |
| function | å‡½æ•°ç±»å‹ï¼Œä¸€ç­‰å…¬æ°‘                 | ä¼šæ€è€ƒçš„é­”æ³•å’’è¯­                   |
| userdata | ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ç±»å‹                 | ä»Cä¸–ç•Œå¬å”¤çš„ç¥ç§˜ç”Ÿç‰©              |
| thread   | ååŒç¨‹åºï¼ˆcoroutineï¼‰              | æ—¶é—´çš„é­”æœ¯å¸ˆï¼Œèƒ½æš‚åœå’Œæ¢å¤æ‰§è¡Œ     |

è®©æˆ‘ä»¬çœ‹çœ‹è¿™äº›é­”æ³•å…ƒç´ å¦‚ä½•è¿ä½œï¼š

```lua
print("**********å˜é‡ç±»å‹æ¢ç´¢**********")

-- 1. nilå˜é‡ï¼šè™šæ— çš„èµ·ç‚¹
a = nil
print("açš„å€¼: ", a, " açš„ç±»å‹: ", type(a))

-- 2. numberå˜é‡ï¼šç²¾ç¡®çš„æ•°å­¦ç²¾çµ
num = 100
print("numçš„å€¼: ", num, " numçš„ç±»å‹: ", type(num))
pi = 3.14159
print("piçš„å€¼: ", pi, " piçš„ç±»å‹: ", type(pi))

-- 3. stringå˜é‡ï¼šæ–‡å­—çš„èˆè€…
str = "Hello, World! "
print("strçš„å€¼: ", str, " strçš„ç±»å‹: ", type(str))

-- 4. booleanå˜é‡ï¼šéé»‘å³ç™½çš„å†³ç­–è€…
bool = true
print("boolçš„å€¼: ", bool, " boolçš„ç±»å‹: ", type(bool))

-- æœªå®šä¹‰çš„å˜é‡ï¼šé»˜è®¤ä¸ºnil
print("å˜é‡ \"ABCD\" çš„ç±»å‹æ˜¯ ", type(ABCD))
```

> **æœ‰è¶£çš„äº‹å®**ï¼šLuaä¸­å˜é‡å¯ä»¥éšæ„"å˜æ€§"ï¼Œä»æ•°å­—å˜æˆå­—ç¬¦ä¸²ï¼Œä»å¸ƒå°”å˜æˆè¡¨æ ¼ï¼Œå°±åƒå˜å½¢é‡‘åˆšä¸€æ ·ï¼ä½†è¯·è®°ä½ï¼Œè¿‡åº¦å˜èº«å¯èƒ½ä¼šè®©ä»£ç å˜å¾—éš¾ä»¥ç†è§£ï¼Œå°±åƒè®©ä½ çš„æœ‹å‹åŒæ—¶æ‰®æ¼”5ä¸ªè§’è‰²ä¸€æ ·æ··ä¹±ã€‚

```lua
print("**********å˜é‡çš„å¤šé‡å˜èº«**********")
a = 10
print("açš„å€¼:", a, " açš„ç±»å‹:", type(a))
a = "Hello, World!"
print("açš„å€¼:", a, " açš„ç±»å‹:", type(a))
```

## 2.4 å­—ç¬¦ä¸²ï¼šä¸åªæ˜¯æ–‡å­—çš„æ¸¸æˆ

åœ¨Luaä¸­ï¼Œå­—ç¬¦ä¸²ç”¨å•å¼•å·æˆ–åŒå¼•å·éƒ½å¯ä»¥ï¼Œéšä½ å¿ƒæƒ…åˆ‡æ¢ï¼š

```lua
print("**********å­—ç¬¦ä¸²çš„å£°æ˜**********")
str1 = "Hello, World!" -- åŒå¼•å·
str2 = 'ä½ å¥½ï¼ŒLuaï¼' -- å•å¼•å·
```

#### å­—ç¬¦ä¸²æ“ä½œå¤§å¸ˆç­

```lua
print("**********å­—ç¬¦ä¸²æ“ä½œè‰ºæœ¯**********")
str = "Hello, Lua! "

-- 1. é•¿åº¦è®¡ç®— - æ³¨æ„ï¼šåœ¨Lua 5.3+ä¸­ï¼Œ#è¿ç®—ç¬¦è¿”å›çš„æ˜¯å­—ç¬¦æ•°è€Œéå­—èŠ‚æ•°ï¼ˆUTF-8ç¼–ç ï¼‰
print("å­—ç¬¦ä¸²é•¿åº¦: ", #str) -- è¾“å‡º: 12

-- 2. è¿æ¥ - ä½¿ç”¨ .. æ“ä½œç¬¦ï¼Œåƒèƒ¶æ°´ä¸€æ ·æŠŠå­—ç¬¦ä¸²ç²˜åœ¨ä¸€èµ·
greeting = "Hello " .. ", " .. "World! "
print(greeting) -- è¾“å‡º: Hello, World!

-- 3. æ ¼å¼åŒ– - ç›¸å½“äºCè¯­è¨€çš„sprintf
formatted = string.format("ä»Šå¤©æ˜¯%då¹´%dæœˆ%dæ—¥ï¼Œæ¸©åº¦%.1fÂ°C", 2026, 1, 9, 25.5)
print(formatted) -- è¾“å‡º: ä»Šå¤©æ˜¯2026å¹´1æœˆ9æ—¥ï¼Œæ¸©åº¦25.5Â°C

-- 4. å¤§å°å†™è½¬æ¢
mixedCase = "AbCdEfG "
print(string.upper(mixedCase)) -- è¾“å‡º: ABCDEFG
print(string.lower(mixedCase)) -- è¾“å‡º: abcdefg

-- 5. æŸ¥æ‰¾å’Œæ›¿æ¢
text = "I love Lua, Lua is awesome! "
pos = string.find(text, "Lua") -- è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…ä½ç½®
print("ç¬¬ä¸€æ¬¡æ‰¾åˆ°'Lua'çš„ä½ç½®: ", pos) -- è¾“å‡º: 8
newText, count = string.gsub(text, "Lua", "Python")
print("æ›¿æ¢å: ", newText) -- è¾“å‡º: I love Python, Python is awesome!
print("æ›¿æ¢æ¬¡æ•°: ", count) -- è¾“å‡º: 2

-- 6. æˆªå–å’Œåè½¬
substring = string.sub(text, 8, 10) -- ä»ç¬¬8ä¸ªå­—ç¬¦å¼€å§‹ï¼Œåˆ°ç¬¬10ä¸ªå­—ç¬¦ç»“æŸ
print("æˆªå–: ", substring) -- è¾“å‡º: Lua
reversed = string.reverse("hello")
print("åè½¬: ", reversed) -- è¾“å‡º: olleh
```

> **å…³é”®æ³¨æ„**ï¼šLuaå­—ç¬¦ä¸²ç´¢å¼•ä»1å¼€å§‹ï¼Œä¸æ˜¯0ï¼è¿™ä¼šè®©Cæˆ–Javaç¨‹åºå‘˜æŠ“ç‹‚ï¼Œå°±åƒå·¦æ’‡å­ç”¨å³æ‰‹å†™å­—ä¸€æ ·åˆ«æ‰­ã€‚å¤šç»ƒä¹ ï¼Œä½ ä¼šä¹ æƒ¯çš„ï¼

#### å¤šè¡Œå­—ç¬¦ä¸²ï¼šä¸‰å¼•å·é­”æ³•

```lua
-- é•¿å­—ç¬¦ä¸²ï¼Œä¸ç”¨æ‹…å¿ƒè½¬ä¹‰å­—ç¬¦
longStr = [[
è¿™æ˜¯ä¸€ä¸ªå¤šè¡Œå­—ç¬¦ä¸²ï¼
å¯ä»¥åŒ…å«"å¼•å·"è€Œä¸éœ€è½¬ä¹‰
ä¹Ÿå¯ä»¥åŒ…å«'å•å¼•å·'ï¼
ç”šè‡³å¯ä»¥åŒ…å«\næ¢è¡Œç¬¦ä½œä¸ºæ™®é€šå­—ç¬¦
]]
print(longStr)
```

## 2.5 è¿ç®—ç¬¦ï¼šæ•°å­¦ä¸é€»è¾‘çš„å°æŠŠæˆ

#### ç®—æœ¯è¿ç®—ç¬¦

`+ - * / %`ï¼ˆå–ä½™ï¼‰`^`ï¼ˆå¹‚è¿ç®—ï¼‰

```lua
print("10 + 5 =", 10 + 5) -- 15
print("10 - 5 =", 10 - 5) -- 5
print("10 * 5 =", 10 * 5) -- 50
print("10 / 5 =", 10 / 5) -- 2.0
print("10 % 3 =", 10 % 3) -- 1
print("2 ^ 3 =", 2 ^ 3) -- 8
```

> **æ³¨æ„**ï¼šLuaæ²¡æœ‰è‡ªå¢(++)å’Œè‡ªå‡(--)è¿ç®—ç¬¦ï¼æ˜¯çš„ï¼Œä½ æ²¡çœ‹é”™ï¼Œè¿™å¯¹Cç³»è¯­è¨€ç¨‹åºå‘˜å¯èƒ½æ˜¯ä¸ªæ–‡åŒ–å†²å‡»ã€‚æ›¿ä»£æ–¹æ¡ˆæ˜¯ï¼š
>
> ```lua
> i = i + 1 -- è€å®äººå†™æ³•
> ```

#### æ¯”è¾ƒè¿ç®—ç¬¦

`> < >= <= == ~=`ï¼ˆä¸ç­‰äºï¼‰

```lua
print("10 > 5 is", 10 > 5) -- true
print("10 == 10 is", 10 == 10) -- true
print("10 ~= 5 is", 10 ~= 5) -- true
```

#### é€»è¾‘è¿ç®—ç¬¦

`and or not` - éµå¾ªçŸ­è·¯åŸåˆ™

```lua
-- çŸ­è·¯åŸåˆ™ç¤ºä¾‹
result = true and "Hello" -- "Hello"ï¼ˆå› ä¸ºtrueä¸ºçœŸï¼Œè¿”å›ç¬¬äºŒä¸ªæ“ä½œæ•°ï¼‰
result = false and "Hello" -- falseï¼ˆå› ä¸ºç¬¬ä¸€ä¸ªä¸ºå‡ï¼Œä¸è®¡ç®—ç¬¬äºŒä¸ªï¼‰
result = true or "Hello" -- trueï¼ˆå› ä¸ºç¬¬ä¸€ä¸ªä¸ºçœŸï¼Œä¸è®¡ç®—ç¬¬äºŒä¸ªï¼‰
result = false or "Hello" -- "Hello"ï¼ˆå› ä¸ºç¬¬ä¸€ä¸ªä¸ºå‡ï¼Œè¿”å›ç¬¬äºŒä¸ªï¼‰

-- å®ç”¨æŠ€å·§ï¼šæ¨¡æ‹Ÿä¸‰å…ƒè¿ç®—ç¬¦
a, b = 10, 20
max = (a > b) and a or b -- ç›¸å½“äºCè¯­è¨€çš„ a > b ? a : b
```

> **å†·çŸ¥è¯†**ï¼šåœ¨Luaä¸­ï¼Œåªæœ‰`false`å’Œ`nil`è¢«è§†ä¸ºå‡ï¼Œå…¶ä»–æ‰€æœ‰å€¼ï¼ˆåŒ…æ‹¬0å’Œç©ºå­—ç¬¦ä¸²ï¼‰éƒ½è¢«è§†ä¸ºçœŸï¼è¿™ç‚¹ä¸å¾ˆå¤šè¯­è¨€ä¸åŒï¼Œè®°å¾—è¿™ä¸ªé™·é˜±ï¼Œå¦åˆ™ä½ çš„æ¡ä»¶åˆ¤æ–­å¯èƒ½ä¼šè®©ä½ æŠ“ç‹‚ï¼š
>
> ```lua
> if 0 then print("0åœ¨Luaä¸­æ˜¯çœŸå€¼!") end -- ä¼šæ‰§è¡Œï¼
> if "" then print("ç©ºå­—ç¬¦ä¸²åœ¨Luaä¸­ä¹Ÿæ˜¯çœŸå€¼!") end -- ä¼šæ‰§è¡Œï¼
> ```

# ğŸ§™ ç¬¬ä¸‰ç« ï¼šå’’è¯­ç¼–æ’ - æµç¨‹æ§åˆ¶çš„è‰ºæœ¯

## 3.1 æ¡ä»¶åˆ†æ”¯ï¼šif-then-elseçš„é­”æ³•

```lua
score = 85
if score >= 90 then 
    print("Açº§ï¼Œä¼˜ç§€ï¼")
elseif score >= 80 then 
    print("Bçº§ï¼Œè‰¯å¥½ï¼")
elseif score >= 70 then 
    print("Cçº§ï¼ŒåŠæ ¼ï¼")
else 
    print("Dçº§ï¼Œéœ€è¦åŠªåŠ›äº†...")
end
```

> **æœ‰è¶£çš„äº‹å®**ï¼šLuaæ²¡æœ‰switchè¯­å¥ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨è¡¨æ¥æ¨¡æ‹Ÿï¼å°±åƒç”¨ä¹é«˜ç§¯æœ¨æ­å‡ºä½ æƒ³è¦çš„ä»»ä½•å½¢çŠ¶ä¸€æ ·çµæ´»ï¼š

```lua
-- æ¨¡æ‹Ÿswitchè¯­å¥
local switch = {
    [1] = function() print("é€‰æ‹©äº†1") end,
    [2] = function() print("é€‰æ‹©äº†2") end,
    default = function() print("é»˜è®¤é€‰é¡¹") end
}
local choice = 2
(switch[choice] or switch.default)() -- é€‰æ‹©äº†2
```

## 3.2 å¾ªç¯ï¼šé‡å¤çš„è‰ºæœ¯

#### whileå¾ªç¯ï¼šå…ˆåˆ¤æ–­åæ‰§è¡Œ

```lua
i = 1
while i <= 5 do 
    print("while å¾ªç¯:", i)
    i = i + 1
end
```

#### repeat-untilå¾ªç¯ï¼šå…ˆæ‰§è¡Œååˆ¤æ–­ï¼ˆç±»ä¼¼do-whileï¼‰

```lua
i = 1
repeat 
    print("repeat-until å¾ªç¯:", i)
    i = i + 1
until i > 5
```

#### forå¾ªç¯ï¼šæœ€ä¼˜é›…çš„è¿­ä»£æ–¹å¼

```lua
-- æ•°å€¼forå¾ªç¯
for i = 1, 5, 1 do -- ä»1åˆ°5ï¼ˆåŒ…å«5ï¼‰ï¼Œæ­¥é•¿ä¸º1
    print("for å¾ªç¯:", i)
end

-- éå†table
fruits = {"apple", "banana", "orange"}
for index, value in ipairs(fruits) do 
    print("æ°´æœ #" .. index .. ": " .. value)
end
```

> **é‡è¦æç¤º**ï¼šLuaçš„`for`å¾ªç¯å˜é‡åœ¨å¾ªç¯å¤–éƒ¨æ˜¯ä¸å¯è§çš„ï¼è¿™æ˜¯ä¸å…¶ä»–è¯­è¨€çš„ä¸€ä¸ªé‡è¦åŒºåˆ«ï¼š
>
> ```lua
> for i = 1, 10 do 
>     -- do something
> end
> print(i) -- è¾“å‡ºnilï¼Œiåœ¨å¾ªç¯å¤–ä¸å¯è§ï¼
> ```

# âœ¨ ç¬¬å››ç« ï¼šé­”åŠ›å°è£… - å‡½æ•°çš„çµæ´»è¿ç”¨

## 4.1 å‡½æ•°çš„å®šä¹‰ï¼šä¸¤ç§é­”æ³•å½¢æ€

Luaå‡½æ•°æœ‰ä¸¤ç§å®šä¹‰æ–¹å¼ï¼Œå®è´¨ç›¸åŒï¼š

```lua
-- æ–¹å¼1ï¼šå‡½æ•°è¯­æ³•ç³–ï¼ˆä¼˜é›…å†™æ³•ï¼‰
function greet(name) 
    return "Hello, " .. name .. "!"
end

-- æ–¹å¼2ï¼šå˜é‡èµ‹å€¼ï¼ˆæ­ç¤ºäº†å‡½æ•°æœ¬è´¨æ˜¯å˜é‡ï¼‰
greet = function(name) 
    return "Hello, " .. name .. "!"
end

print(greet("Lua")) -- è¾“å‡º: Hello, Lua!
```

> **é­”æ³•æœ¬è´¨**ï¼šåœ¨Luaä¸­ï¼Œå‡½æ•°æ˜¯"ä¸€ç­‰å…¬æ°‘"ï¼Œå¯ä»¥åƒæ™®é€šå˜é‡ä¸€æ ·è¢«èµ‹å€¼ã€ä¼ é€’å’Œè¿”å›ã€‚è¿™ç§è®¾è®¡è®©Luaæ‹¥æœ‰äº†å‡½æ•°å¼ç¼–ç¨‹çš„çµé­‚ã€‚

## 4.2 å‚æ•°å’Œè¿”å›å€¼ï¼šçµæ´»å¾—è®©äººæƒŠè®¶

Luaå‡½æ•°å¯¹å‚æ•°ä¸ªæ•°ååˆ†å®½å®¹ï¼Œå°±åƒä¸€ä¸ªä»ä¸è®°ä»‡çš„æœ‹å‹ï¼š

```lua
function sum(a, b) 
    a = a or 0 -- å¦‚æœaä¸ºnilï¼Œåˆ™è®¾ä¸º0
    b = b or 0 -- å¦‚æœbä¸ºnilï¼Œåˆ™è®¾ä¸º0
    return a + b
end

print(sum(10, 20)) -- 30
print(sum(10)) -- 10ï¼ˆbä¸ºnilï¼Œè¢«è®¾ä¸º0ï¼‰
print(sum()) -- 0ï¼ˆaå’Œbéƒ½æ˜¯nilï¼Œéƒ½è¢«è®¾ä¸º0ï¼‰
print(sum(1, 2, 3)) -- 3ï¼ˆ3è¢«å¿½ç•¥ï¼ŒLuaä¸æŠ¥é”™ï¼ï¼‰
```

#### å¤šè¿”å›å€¼ï¼šLuaçš„è¶…èƒ½åŠ›

Luaå‡½æ•°å¯ä»¥è¿”å›å¤šä¸ªå€¼ï¼Œè¿™åœ¨å…¶ä»–è¯­è¨€ä¸­éœ€è¦ä½¿ç”¨æ•°ç»„æˆ–å…ƒç»„ï¼š

```lua
function minMax(table) 
    local min = table[1]
    local max = table[1]
    for i, v in ipairs(table) do 
        if v < min then min = v end
        if v > max then max = v end
    end
    return min, max
end

numbers = {3, 1, 4, 1, 5, 9, 2, 6}
minValue, maxValue = minMax(numbers)
print("æœ€å°å€¼:", minValue, "æœ€å¤§å€¼:", maxValue) -- æœ€å°å€¼: 1 æœ€å¤§å€¼: 9
```

## 4.3 å˜é•¿å‚æ•°ï¼šä¸ç¡®å®šæ€§çš„è‰ºæœ¯

å½“ä¸ç¡®å®šéœ€è¦å¤šå°‘å‚æ•°æ—¶ï¼Œ`...`æ¥æ•‘åœºï¼š

```lua
function average(...)
    local args = {...} -- å°†å˜é•¿å‚æ•°è½¬ä¸ºtable
    local sum = 0
    for i, v in ipairs(args) do 
        sum = sum + v
    end
    return #args > 0 and sum / #args or 0 -- é˜²æ­¢é™¤é›¶é”™è¯¯
end

print("å¹³å‡å€¼:", average(1, 2, 3, 4, 5)) -- 3.0
print("å¹³å‡å€¼:", average(10, 20, 30)) -- 20.0
print("ç©ºå‚æ•°å¹³å‡å€¼:", average()) -- 0ï¼ˆä¼˜é›…å¤„ç†è¾¹ç•Œæƒ…å†µï¼‰
```

## 4.4 é—­åŒ…ï¼šçŠ¶æ€çš„å®ˆæŠ¤è€…

é—­åŒ…æ˜¯Luaæœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒèƒ½è®©å‡½æ•°"è®°ä½"åˆ›å»ºæ—¶çš„ç¯å¢ƒï¼š

```lua
function counter(start) 
    local count = start or 0
    return function() 
        count = count + 1
        return count
    end
end

c1 = counter(10)
print(c1()) -- 11
print(c1()) -- 12

c2 = counter(100)
print(c2()) -- 101
print(c1()) -- 13ï¼ˆä¸å—c2å½±å“ï¼é—­åŒ…ä¿æŒäº†ç‹¬ç«‹çŠ¶æ€ï¼‰
```

> **å®é™…åº”ç”¨**ï¼šé—­åŒ…åœ¨å®ç°è¿­ä»£å™¨ã€ç§æœ‰å˜é‡å’Œå›è°ƒå‡½æ•°æ—¶éå¸¸æœ‰ç”¨ï¼Œæ˜¯Luaå‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥ç”¨é—­åŒ…åˆ›å»ºä¸€ä¸ªåªè¯»çš„é…ç½®å¯¹è±¡ï¼Œå¤–éƒ¨æ— æ³•ä¿®æ”¹å…¶å†…éƒ¨çŠ¶æ€ï¼š

```lua
function createConfig(initialConfig)
    local config = initialConfig or {}
    return function(key)
        return config[key]
    end
end

appConfig = createConfig({debug = true, version = "1.0.0"})
print(appConfig("debug")) -- true
-- æ— æ³•ä¿®æ”¹configï¼Œä¿æŠ¤äº†å†…éƒ¨çŠ¶æ€
```

# ğŸ´ ç¬¬äº”ç« ï¼šä¸‡èƒ½å¡ç‰Œ - è¡¨(Table)çš„ä¸ƒåäºŒå˜

è¡¨æ˜¯Luaä¸­å”¯ä¸€çš„æ•°æ®ç»“æ„ï¼Œå´èƒ½æ¨¡æ‹Ÿæ•°ç»„ã€å­—å…¸ã€å¯¹è±¡ã€æ¨¡å—ç­‰ç­‰ã€‚å®ƒå°±åƒå˜å½¢é‡‘åˆšï¼Œèƒ½å˜æˆä½ éœ€è¦çš„ä»»ä½•å½¢çŠ¶ï¼

## 5.1 æ•°ç»„ï¼šæœ‰åºçš„é›†åˆ

```lua
-- åˆ›å»ºæ•°ç»„
fruits = {"apple", "banana", "orange"}

-- è®¿é—®å…ƒç´ ï¼ˆæ³¨æ„ï¼šç´¢å¼•ä»1å¼€å§‹ï¼ï¼‰
print("ç¬¬ä¸€ä¸ªæ°´æœ:", fruits[1]) -- apple
print("ç¬¬äºŒä¸ªæ°´æœ:", fruits[2]) -- banana

-- æ•°ç»„é•¿åº¦
print("æ°´æœæ•°é‡:", #fruits) -- 3

-- éå†æ•°ç»„
for i = 1, #fruits do 
    print(i, fruits[i])
end

-- ä½¿ç”¨ipairsï¼ˆæ›´Luaé£æ ¼ï¼‰
for i, fruit in ipairs(fruits) do 
    print(i, fruit)
end
```

> **é‡è¦æç¤º**ï¼šLuaçš„æ•°ç»„ç´¢å¼•ä»1å¼€å§‹ï¼Œä¸æ˜¯0ï¼è®°ä½è¿™ä¸ªï¼Œå¯ä»¥é¿å…æ— æ•°æ·±å¤œdebugçš„ç—›è‹¦ã€‚å¯ä»¥æŠŠè¿™æƒ³è±¡æˆLuaå¯¹äººç±»çš„å‹å¥½è®¾è®¡â€”â€”äººç±»æ•°æ•°ä¹Ÿæ˜¯ä»1å¼€å§‹çš„ï¼

## 5.2 å­—å…¸ï¼šé”®å€¼å¯¹çš„é›†åˆ

```lua
-- åˆ›å»ºå­—å…¸
person = { 
    name = "å¼ ä¸‰", 
    age = 30, 
    city = "åŒ—äº¬"
}

-- è®¿é—®å…ƒç´ ï¼ˆä¸¤ç§æ–¹å¼ï¼‰
print(person.name) -- å¼ ä¸‰
print(person["age"]) -- 30

-- æ·»åŠ /ä¿®æ”¹å…ƒç´ 
person.job = "ç¨‹åºå‘˜"
person["hobby"] = "æ¸¸æˆå¼€å‘"

-- éå†å­—å…¸ï¼ˆå¿…é¡»ç”¨pairsï¼‰
for key, value in pairs(person) do 
    print(key, "=", value)
end
```

## 5.3 å¤šç»´è¡¨ï¼šè¡¨æ ¼çš„åµŒå¥—è‰ºæœ¯

```lua
-- äºŒç»´æ•°ç»„
matrix = { 
    {1, 2, 3}, 
    {4, 5, 6}, 
    {7, 8, 9}
}
print("matrix[2][3] =", matrix[2][3]) -- 6

-- æ··åˆè¡¨ï¼ˆæ•°ç»„+å­—å…¸ï¼‰
students = { 
    { 
        id = 1, 
        name = "å¼ ä¸‰", 
        grades = {math = 90, english = 85} 
    }, 
    { 
        id = 2, 
        name = "æå››", 
        grades = {math = 78, english = 92} 
    }
}
print("æå››çš„è‹±è¯­æˆç»©:", students[2].grades.english) -- 92
```

## 5.4 è¡¨çš„æ ‡å‡†åº“æ“ä½œ

Luaæä¾›äº†ä¸°å¯Œçš„è¡¨æ“ä½œå‡½æ•°ï¼š

```lua
t = {10, 20, 30, 40}

-- æ’å…¥å…ƒç´ 
table.insert(t, 1, 5) -- åœ¨ä½ç½®1æ’å…¥5
table.insert(t, 50) -- åœ¨æœ«å°¾æ’å…¥50
-- tç°åœ¨æ˜¯{5, 10, 20, 30, 40, 50}

-- ç§»é™¤å…ƒç´ 
table.remove(t, 1) -- ç§»é™¤ä½ç½®1çš„å…ƒç´ 
table.remove(t) -- ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ 
-- tç°åœ¨æ˜¯{10, 20, 30, 40}

-- æ’åº
table.sort(t) -- å‡åºæ’åº
-- tç°åœ¨æ˜¯{10, 20, 30, 40}

-- è‡ªå®šä¹‰æ’åº
points = { 
    {x = 3, y = 5}, 
    {x = 1, y = 2}, 
    {x = 4, y = 1}
}
table.sort(points, function(a, b) 
    return a.x < b.x -- æŒ‰xåæ ‡å‡åºæ’åˆ—
end)

-- è¿æ¥å­—ç¬¦ä¸²
names = {"Alice", "Bob", "Charlie"}
print(table.concat(names, ", ")) -- Alice, Bob, Charlie
```

# ğŸš€ ç¬¬å…­ç« ï¼šé«˜çº§é­”æ³• - å…ƒè¡¨ã€é—­åŒ…ä¸é¢å‘å¯¹è±¡

## 6.1 å…¨å±€å˜é‡ä¸å±€éƒ¨å˜é‡ï¼šä½œç”¨åŸŸçš„è‰ºæœ¯

```lua
globalVar = "æˆ‘æ˜¯å…¨å±€å˜é‡" -- å…¨å±€å˜é‡ï¼Œä»»ä½•åœ°æ–¹éƒ½å¯è§

function testScope() 
    local localVar = "æˆ‘æ˜¯å±€éƒ¨å˜é‡" -- åªåœ¨å‡½æ•°å†…å¯è§
    innerVar = "æˆ‘æœ¬æƒ³æ˜¯å±€éƒ¨çš„ï¼Œä½†æ˜¯å¿˜äº†localå…³é”®å­—ï¼" -- æ‚²å‰§ï¼Œå˜æˆäº†å…¨å±€å˜é‡ï¼
    print(localVar) -- æ­£å¸¸è¾“å‡º
    print(innerVar) -- æ­£å¸¸è¾“å‡º
end

testScope()
print(globalVar) -- æ­£å¸¸è¾“å‡º
-- print(localVar) -- é”™è¯¯ï¼localVaråœ¨å‡½æ•°å¤–ä¸å¯è§
print(innerVar) -- èƒ½è¾“å‡ºï¼ä½†è¿™æ˜¯ä¸ªbugéšæ‚£
```

> **æœ€ä½³å®è·µ**ï¼šé™¤éç¡®å®éœ€è¦ï¼Œå¦åˆ™æ€»æ˜¯ä½¿ç”¨`local`å…³é”®å­—ï¼è¿™å°±åƒæŠŠè´µé‡ç‰©å“é”åœ¨ä¿é™©ç®±é‡Œï¼Œè€Œä¸æ˜¯éšæ‰‹æ”¾åœ¨æ¡Œå­ä¸Šã€‚å…¨å±€å˜é‡ä¸ä»…æ…¢ï¼ˆè®¿é—®é€Ÿåº¦æ¯”å±€éƒ¨å˜é‡æ…¢ï¼‰ï¼Œè€Œä¸”å®¹æ˜“é€ æˆå‘½åå†²çªå’Œéš¾ä»¥è¿½è¸ªçš„bugã€‚

## 6.2 æ¨¡å—ä¸requireï¼šä»£ç çš„æ‹¼å›¾æ¸¸æˆ

Luaä½¿ç”¨`require`æ¥åŠ è½½æ¨¡å—ï¼Œè¿™å°±åƒå¯¼å…¥å…¶ä»–æ‹¼å›¾å—æ¥å®Œæˆæ•´å¹…ç”»é¢ï¼š

```lua
-- mymodule.lua
local M = {} -- åˆ›å»ºæ¨¡å—è¡¨
function M.hello(name) 
    return "Hello, " .. name
end
function M.goodbye(name) 
    return "Goodbye, " .. name
end
return M -- è¿”å›æ¨¡å—

-- main.lua
local mymodule = require("mymodule") -- åŠ è½½æ¨¡å—
print(mymodule.hello("Lua")) -- Hello, Lua
print(mymodule.goodbye("Lua")) -- Goodbye, Lua
```

> **æ¨¡å—ä½¿ç”¨è¦ç‚¹**ï¼š
>
> - `require`ä¼šç¼“å­˜å·²åŠ è½½çš„æ¨¡å—ï¼Œå¤šæ¬¡è°ƒç”¨ä¸ä¼šé‡å¤æ‰§è¡Œ
> - æ¨¡å—è·¯å¾„ä½¿ç”¨ç‚¹å·(.)è€Œä¸æ˜¯æ–œæ (/)
> - ä¸éœ€è¦æ·»åŠ .luaåç¼€
> - æ¨¡å—ä¸­åº”å°½é‡ä½¿ç”¨localå˜é‡ï¼Œåªæš´éœ²å¿…è¦çš„æ¥å£
> - ä½¿ç”¨`package.path`å¯ä»¥è‡ªå®šä¹‰æ¨¡å—æœç´¢è·¯å¾„

## 6.3 å…ƒè¡¨ï¼ˆMetatableï¼‰ï¼šæ”¹å˜è¡¨çš„è¡Œä¸º ğŸ’¥

å…ƒè¡¨æ˜¯Luaæœ€å¼ºå¤§ä¹Ÿæœ€å¤æ‚çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒå…è®¸ä½ é‡å®šä¹‰è¡¨çš„æ“ä½œè¡Œä¸ºï¼š

```lua
-- åˆ›å»ºä¸€ä¸ªå‘é‡
vector1 = {x = 10, y = 20}
vector2 = {x = 30, y = 40}

-- åˆ›å»ºå…ƒè¡¨
vectorMT = { 
    __add = function(a, b) -- å®šä¹‰+æ“ä½œ
        return {x = a.x + b.x, y = a.y + b.y}
    end,
    __tostring = function(v) -- å®šä¹‰tostringè¡Œä¸º
        return "(" .. v.x .. ", " .. v.y .. ")"
    end
}

-- è®¾ç½®å…ƒè¡¨
setmetatable(vector1, vectorMT)
setmetatable(vector2, vectorMT)

-- æµ‹è¯•
result = vector1 + vector2 -- ä¼šè°ƒç”¨__add
print(result) -- ä¼šè°ƒç”¨__tostringï¼Œè¾“å‡º: (40, 60)
```

#### ä¸»è¦å…ƒæ–¹æ³•åŒ…æ‹¬ï¼š

- `__add(a, b)`: + æ“ä½œ
- `__sub(a, b)`: - æ“ä½œ
- `__mul(a, b)`: * æ“ä½œ
- `__div(a, b)`: / æ“ä½œ
- `__mod(a, b)`: % æ“ä½œ
- `__pow(a, b)`: ^ æ“ä½œ
- `__concat(a, b)`: .. æ“ä½œ
- `__len(a)`: # æ“ä½œ
- `__eq(a, b)`: == æ“ä½œ
- `__lt(a, b)`: < æ“ä½œ
- `__le(a, b)`: <= æ“ä½œ
- `__call(a, ...)`: å‡½æ•°è°ƒç”¨æ“ä½œ
- `__tostring(a)`: tostring è½¬æ¢
- `__index(a, k)`: è¡¨è®¿é—®
- `__newindex(a, k, v)`: è¡¨èµ‹å€¼

#### `__index` å’Œ `__newindex`ï¼šé¢å‘å¯¹è±¡çš„åŸºçŸ³

```lua
-- åˆ›å»ºåŸå‹
Person = { 
    species = "Human", 
    saySpecies = function(self) 
        print("I am a " .. self.species) 
    end
}

-- åˆ›å»ºå…ƒè¡¨
PersonMT = { 
    __index = Person -- å½“è®¿é—®ä¸å­˜åœ¨çš„å­—æ®µæ—¶ï¼Œä¼šåœ¨è¿™é‡ŒæŸ¥æ‰¾
}

-- åˆ›å»ºå®ä¾‹
john = {}
setmetatable(john, PersonMT)
john.saySpecies() -- è¾“å‡º: I am a Human
print(john.species) -- è¾“å‡º: Human
```

# ğŸ“ ç¬¬ä¸ƒç« ï¼šé¢å‘å¯¹è±¡ï¼šç”¨è¡¨æ¨¡æ‹Ÿç±»

LuaåŸç”Ÿä¸æ”¯æŒé¢å‘å¯¹è±¡ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡è¡¨å’Œå…ƒè¡¨æ¨¡æ‹Ÿå‡ºå®Œæ•´çš„é¢å‘å¯¹è±¡ç³»ç»Ÿï¼š

## 7.1 å°è£…ï¼šæŠŠæ•°æ®å’Œæ–¹æ³•æ‰“åŒ…

```lua
-- å®šä¹‰ä¸€ä¸ªç±»
Person = {}
Person.__index = Person -- å…³é”®ï¼è¿™æ ·å®ä¾‹å¯ä»¥è®¿é—®ç±»çš„æ–¹æ³•

function Person.new(name, age) 
    local self = setmetatable({}, Person) -- åˆ›å»ºæ–°å®ä¾‹å¹¶è®¾ç½®å…ƒè¡¨
    self.name = name
    self.age = age
    return self
end

function Person:sayHello() -- æ³¨æ„å†’å·è¯­æ³•ï¼Œä¼šè‡ªåŠ¨ä¼ å…¥self
    print("Hello, I'm " .. self.name .. ", I'm " .. self.age .. " years old.")
end

-- åˆ›å»ºå®ä¾‹
alice = Person.new("Alice", 25)
bob = Person.new("Bob", 30)
alice:sayHello() -- Hello, I'm Alice, I'm 25 years old.
bob:sayHello() -- Hello, I'm Bob, I'm 30 years old.
```

## 7.2 ç»§æ‰¿ï¼šç«™åœ¨å·¨äººçš„è‚©è†€ä¸Š

```lua
-- å®šä¹‰å­ç±»
Student = {}
Student.__index = Student

-- è®¾ç½®ç»§æ‰¿
setmetatable(Student, Person) -- Studentç»§æ‰¿Person
Student.__index = Student -- é‡è¦ï¼é‡è®¾__index

function Student.new(name, age, grade) 
    local self = Person.new(name, age) -- è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
    setmetatable(self, Student) -- é‡æ–°è®¾ç½®å…ƒè¡¨
    self.grade = grade
    return self
end

function Student:sayHello() -- é‡å†™æ–¹æ³•
    print("Hello, I'm student " .. self.name .. ", I'm in grade " .. self.grade)
end

-- æµ‹è¯•
alice = Student.new("Alice", 18, 12)
alice:sayHello() -- Hello, I'm student Alice, I'm in grade 12
alice.saySpecies(alice) -- I am a Human (ç»§æ‰¿è‡ªPerson)
```

## 7.3 å¤šæ€ï¼šåŒä¸€æ¥å£ï¼Œå¤šç§å®ç°

```lua
-- æ·»åŠ ä¸€ä¸ªå…±åŒæ¥å£
function Person:makeSound() 
    print("Some generic human sound")
end

function Student:makeSound() 
    print("Student studying quietly...")
end

-- å¤šæ€ç¤ºä¾‹
function makePersonSound(person) 
    person:makeSound() -- æ ¹æ®å®é™…ç±»å‹è°ƒç”¨ä¸åŒå®ç°
end

p = Person.new("John", 35)
s = Student.new("Mary", 17, 11)
makePersonSound(p) -- Some generic human sound
makePersonSound(s) -- Student studying quietly...
```

## 7.4 é¢å‘å¯¹è±¡å®ç°æ€»ç»“

```lua
-- åŸºç±»æ¨¡æ¿
BaseClass = {}
BaseClass.__index = BaseClass

function BaseClass.new(...) 
    local self = setmetatable({}, BaseClass)
    if self.init then
        self:init(...) -- è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•
    end
    return self
end

function BaseClass:init() 
    -- åˆå§‹åŒ–ä»£ç 
end

-- å­ç±»æ¨¡æ¿
SubClass = {}
SubClass.__index = SubClass
setmetatable(SubClass, BaseClass) -- ç»§æ‰¿

function SubClass.new(...) 
    local self = BaseClass.new(...) -- è°ƒç”¨çˆ¶ç±»æ„é€ 
    setmetatable(self, SubClass) -- é‡æ–°è®¾ç½®å…ƒè¡¨
    return self
end

function SubClass:init(...) 
    BaseClass.init(self, ...) -- è°ƒç”¨çˆ¶ç±»åˆå§‹åŒ–
    -- å­ç±»åˆå§‹åŒ–ä»£ç 
end
```

# âš¡ ç¬¬å…«ç« ï¼šæ–½æ³•åŠ é€Ÿ - æ€§èƒ½ä¼˜åŒ–ç§˜ç±

## 8.1 å¸¸è§æ€§èƒ½é™·é˜±

1. **å…¨å±€å˜é‡è®¿é—®æ…¢**ï¼šå±€éƒ¨å˜é‡æ¯”å…¨å±€å˜é‡è®¿é—®é€Ÿåº¦å¿«
2. **è¿‡åº¦åˆ›å»ºè¡¨å’Œå‡½æ•°**ï¼šç‰¹åˆ«æ˜¯åœ¨å¾ªç¯ä¸­
3. **å­—ç¬¦ä¸²æ‹¼æ¥**ï¼šå¤§é‡æ‹¼æ¥ä½¿ç”¨`..`æ“ä½œç¬¦æ•ˆç‡ä½ä¸‹
4. **ä¸åˆç†çš„é€’å½’**ï¼šLuaé»˜è®¤é€’å½’æ·±åº¦é™åˆ¶è¾ƒä½
5. **é¢‘ç¹çš„C-Luaè¾¹ç•Œè°ƒç”¨**ï¼šåœ¨Unityçƒ­æ›´æ–°ä¸­ç‰¹åˆ«è¦æ³¨æ„

## 8.2 ä¼˜åŒ–æŠ€å·§

```lua
-- 1. ç¼“å­˜å…¨å±€å˜é‡
local math_floor = math.floor -- æœ¬åœ°ç¼“å­˜
for i = 1, 1000000 do 
    x = math_floor(y) -- æ¯”ç›´æ¥math.floor(y)å¿«
end

-- 2. é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºè¡¨
-- ä¸å¥½çš„åšæ³•
for i = 1, 1000 do 
    local temp = {x = i, y = i*2} -- æ¯æ¬¡å¾ªç¯åˆ›å»ºæ–°è¡¨
    -- do something
end

-- å¥½çš„åšæ³•
local temp = {}
for i = 1, 1000 do 
    temp.x = i
    temp.y = i*2
    -- do something
end

-- 3. é«˜æ•ˆå­—ç¬¦ä¸²æ‹¼æ¥
local parts = {}
for i = 1, 10000 do 
    parts[i] = tostring(i)
end
local result = table.concat(parts, ",") -- æ¯”ä½¿ç”¨..æ“ä½œç¬¦é«˜æ•ˆå¾—å¤š

-- 4. å‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€ï¼ˆå†…è”ç®€å•å‡½æ•°ï¼‰
local function add(a, b) return a + b end

-- åœ¨æ€§èƒ½å…³é”®è·¯å¾„ä¸Šï¼Œç›´æ¥ä½¿ç”¨ a + b è€Œä¸æ˜¯è°ƒç”¨ add(a, b)

-- 5. é¢„åˆ†é…è¡¨å¤§å°ï¼ˆå¦‚æœçŸ¥é“å¤§å°ï¼‰
local t = {}
for i = 1, 1000 do
    t[i] = i
end

-- æ¯”åŠ¨æ€å¢é•¿æ›´é«˜æ•ˆ
```

## 8.3 åƒåœ¾å›æ”¶æ§åˆ¶

```lua
-- è·å–å½“å‰å†…å­˜ä½¿ç”¨ï¼ˆKBï¼‰
local memory = collectgarbage("count")
print("å½“å‰å†…å­˜ä½¿ç”¨:", memory .. " KB")

-- å¼ºåˆ¶æ‰§è¡Œå®Œæ•´åƒåœ¾å›æ”¶
collectgarbage("collect")

-- è°ƒæ•´åƒåœ¾å›æ”¶å‚æ•°
collectgarbage("setpause", 200) -- è®¾ç½®æ”¶é›†å™¨æš‚åœæ¯”ç‡
collectgarbage("setstepmul", 200) -- è®¾ç½®æ”¶é›†å™¨æ­¥è¿›å€ç‡
```

> **å®ç”¨å»ºè®®**ï¼šåœ¨Unityä¸­ä½¿ç”¨Luaæ—¶ï¼Œç‰¹åˆ«æ˜¯åœ¨çƒ­æ›´æ–°åœºæ™¯ä¸‹ï¼Œåº”å½“æ³¨æ„é¿å…å†…å­˜æ³„æ¼ã€‚å®šæœŸè°ƒç”¨åƒåœ¾å›æ”¶ï¼Œå°¤å…¶æ˜¯åœ¨åŠ è½½/å¸è½½å¤§å‹èµ„æºåã€‚ä½†æ³¨æ„ä¸è¦åœ¨æ¯å¸§éƒ½è°ƒç”¨`collectgarbage()`ï¼Œè¿™ä¼šå¯¼è‡´æ˜æ˜¾çš„å¡é¡¿ã€‚å¯ä»¥ä½¿ç”¨å¢é‡å¼åƒåœ¾å›æ”¶ï¼š
>
> ```lua
> -- æ¯å¸§æ‰§è¡Œä¸€ç‚¹åƒåœ¾å›æ”¶
> collectgarbage("step", 100) -- 100æ˜¯æ­¥é•¿ï¼Œæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
> ```

# ğŸ® ç¬¬ä¹ç« ï¼šæ¸¸æˆæˆ˜åœº - Unityä¸Luaçƒ­æ›´æ–°å®æˆ˜

## 9.1 ä¸ºä»€ä¹ˆé€‰æ‹©Luaè¿›è¡Œçƒ­æ›´æ–°ï¼Ÿ

1. **è½»é‡çº§**ï¼šLuaè§£é‡Šå™¨å°ï¼Œçº¦200-300KBï¼Œå¯¹ç§»åŠ¨è®¾å¤‡å‹å¥½
2. **é«˜æ€§èƒ½**ï¼šJITç¼–è¯‘çš„Luaï¼ˆå¦‚LuaJITï¼‰é€Ÿåº¦æ¥è¿‘åŸç”Ÿä»£ç 
3. **æ˜“äºé›†æˆ**ï¼šC APIç®€å•ï¼Œå®¹æ˜“ä¸Unityçš„C#äº¤äº’
4. **çµæ´»æ€§**ï¼šåŠ¨æ€ç±»å‹ï¼Œæ— éœ€é‡æ–°ç¼–è¯‘å³å¯ä¿®æ”¹æ¸¸æˆé€»è¾‘
5. **ç¤¾åŒºæ”¯æŒ**ï¼šxLuaã€SLuaã€ToLuaç­‰æ¡†æ¶æˆç†Ÿç¨³å®š

## 9.2 ä¸C#çš„å¯¹æ¯”ä¸åä½œ

| ç‰¹æ€§     | C#                   | Lua                       |
| -------- | -------------------- | ------------------------- |
| ç±»å‹ç³»ç»Ÿ | é™æ€å¼ºç±»å‹           | åŠ¨æ€å¼±ç±»å‹                |
| æ€§èƒ½     | é«˜ï¼ˆAOTç¼–è¯‘ï¼‰        | ä¸­ï¼ˆè§£é‡Šæ‰§è¡Œï¼ŒJITå¯æå‡ï¼‰ |
| å†…å­˜ç®¡ç† | GCè‡ªåŠ¨ç®¡ç†           | GCè‡ªåŠ¨ç®¡ç†                |
| çƒ­æ›´æ–°   | éœ€è¦IL2CPPæ”¯æŒï¼Œæœ‰é™ | åŸç”Ÿæ”¯æŒï¼Œå®Œå…¨çµæ´»        |
| å¼€å‘ä½“éªŒ | VS/IDEæ”¯æŒå®Œå–„       | è°ƒè¯•æ”¯æŒè¾ƒå¼±              |

> **æœ€ä½³å®è·µ**ï¼šæ ¸å¿ƒç³»ç»Ÿç”¨C#å®ç°ï¼Œä¸šåŠ¡é€»è¾‘å’Œé¢‘ç¹æ›´æ–°éƒ¨åˆ†ç”¨Luaå®ç°ã€‚å°±åƒå»ºé€ æˆ¿å±‹ï¼ŒC#æ˜¯é’¢ç­‹æ··å‡åœŸçš„ä¸»ä½“ç»“æ„ï¼ŒLuaæ˜¯å¯éšæ—¶æ›´æ¢çš„å†…éƒ¨è£…ä¿®ã€‚

## 9.3 å¸¸è§çƒ­æ›´æ–°é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ

1. **å†…å­˜æ³„æ¼**
   - åŸå› ï¼šLuaè¡¨å¼•ç”¨æœªé‡Šæ”¾ï¼ŒC#å¯¹è±¡è¢«Luaå¼•ç”¨
   - è§£å†³ï¼šä½¿ç”¨å¼±å¼•ç”¨ï¼Œå®šæœŸæ£€æŸ¥å†…å­˜ï¼Œé¿å…å…¨å±€å˜é‡æ»¥ç”¨
2. **æ€§èƒ½ç“¶é¢ˆ**
   - åŸå› ï¼šé¢‘ç¹çš„C#-Luaè¾¹ç•Œè°ƒç”¨
   - è§£å†³ï¼šæ‰¹é‡æ“ä½œï¼Œå‡å°‘è·¨è¯­è¨€è°ƒç”¨æ¬¡æ•°ï¼Œç”¨Luaå®ç°å®Œæ•´çš„é€»è¾‘æ¨¡å—
3. **ç±»å‹ä¸åŒ¹é…**
   - åŸå› ï¼šLuaçš„åŠ¨æ€ç±»å‹ä¸C#çš„é™æ€ç±»å‹å†²çª
   - è§£å†³ï¼šåœ¨å…³é”®æ¥å£æ·»åŠ ç±»å‹æ£€æŸ¥ï¼Œä½¿ç”¨é€‚é…å±‚è½¬æ¢æ•°æ®ç±»å‹
4. **è°ƒè¯•å›°éš¾**
   - åŸå› ï¼šUnityç¼–è¾‘å™¨ä¸ç›´æ¥æ”¯æŒLuaè°ƒè¯•
   - è§£å†³ï¼šä½¿ç”¨ZeroBrane Studioæˆ–VS Codeé…åˆè°ƒè¯•æ’ä»¶ï¼Œç¼–å†™å®Œå–„çš„æ—¥å¿—ç³»ç»Ÿ

## 9.4 å®é™…é¡¹ç›®ç»“æ„å»ºè®®

```
Assets/
â”œâ”€â”€ Lua/
â”‚   â”œâ”€â”€ Core/          # åŸºç¡€æ¡†æ¶
â”‚   â”œâ”€â”€ Modules/       # æ¸¸æˆæ¨¡å—
â”‚   â”œâ”€â”€ UI/            # UIé€»è¾‘
â”‚   â”œâ”€â”€ Configs/       # é…ç½®æ•°æ®
â”‚   â””â”€â”€ main.lua       # å…¥å£æ–‡ä»¶
â”œâ”€â”€ Plugins/           # xLua/ToLuaç­‰æ’ä»¶
â””â”€â”€ Scripts/           # C#ä»£ç ï¼Œè´Ÿè´£åŠ è½½Lua
```

#### åŠ è½½æµç¨‹ï¼š

1. C#åˆå§‹åŒ–Luaç¯å¢ƒ
2. åŠ è½½æ ¸å¿ƒåº“å’Œæ¡†æ¶
3. æ³¨å†ŒC#-Luaäº¤äº’æ¥å£
4. æ‰§è¡Œmain.lua
5. çƒ­æ›´æ–°æ—¶ï¼Œé‡æ–°åŠ è½½ç‰¹å®šLuaæ–‡ä»¶

# ğŸ“š ç¬¬åç« ï¼šé­”æ³•å­¦é™¢ - å­¦ä¹ èµ„æºä¸è¿›é˜¶è·¯çº¿

## 10.1 æ¨èå­¦ä¹ èµ„æº

- **å®˜æ–¹æ–‡æ¡£**: https://www.lua.org/manual/5.4/ - æ°¸è¿œæ˜¯æœ€å¥½çš„å‚è€ƒèµ„æ–™
- **ã€ŠLuaç¨‹åºè®¾è®¡ã€‹**(Programming in Lua) - Luaä¹‹çˆ¶Roberto Ierusalimschyè‘—
- **Lua-users wiki**: http://lua-users.org/wiki/ - ç¤¾åŒºç»´æŠ¤çš„å¤§é‡å®ç”¨æŠ€å·§
- **ZeroBrane Studio**: è½»é‡çº§Lua IDEï¼Œæ”¯æŒè°ƒè¯•
- **LuaRocks**: Luaçš„åŒ…ç®¡ç†å™¨ï¼Œhttps://luarocks.org/

### 10.2 è¿›é˜¶å­¦ä¹ è·¯çº¿

**åŸºç¡€é˜¶æ®µ**ï¼ˆ1-2å‘¨ï¼‰ï¼š

- æŒæ¡åŸºç¡€è¯­æ³•ã€å˜é‡ã€æ§åˆ¶ç»“æ„
- ç†Ÿæ‚‰è¡¨æ“ä½œå’ŒåŸºç¡€å‡½æ•°
- å®Œæˆç®€å•çš„å‘½ä»¤è¡Œç¨‹åº

**ä¸­çº§é˜¶æ®µ**ï¼ˆ2-4å‘¨ï¼‰ï¼š

- æ·±å…¥ç†è§£å…ƒè¡¨æœºåˆ¶
- æŒæ¡é—­åŒ…å’Œé«˜é˜¶å‡½æ•°
- å­¦ä¹ æ¨¡å—åŒ–ç¼–ç¨‹
- å®è·µæ–‡ä»¶æ“ä½œå’Œé”™è¯¯å¤„ç†

**é«˜çº§é˜¶æ®µ**ï¼ˆ1-2ä¸ªæœˆï¼‰ï¼š

- C APIç¼–ç¨‹ï¼Œä¸å®¿ä¸»è¯­è¨€äº¤äº’
- è°ƒè¯•å’Œæ€§èƒ½ä¼˜åŒ–æŠ€å·§
- å®ç°è®¾è®¡æ¨¡å¼
- é˜…è¯»å¼€æºLuaæ¡†æ¶æºç 

**ä¸“å®¶é˜¶æ®µ**ï¼ˆæŒç»­ï¼‰ï¼š

- å®ç°è‡ªå®šä¹‰è™šæ‹Ÿæœºè¡Œä¸º
- JITä¼˜åŒ–
- è´¡çŒ®Luaæ ¸å¿ƒæˆ–é‡è¦åº“
- è®¾è®¡é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆDSLï¼‰

# ğŸŒˆ ç»“è¯­ï¼šäº«å—ä½ çš„Luaé­”æ³•ä¹‹æ—…

Luaå°±åƒä¸€è¾†è½»ä¾¿çš„å±±åœ°è‡ªè¡Œè½¦â€”â€”ç®€å•ã€çµæ´»ã€èƒ½å¸¦ä½ å»å¾ˆå¤šåœ°æ–¹ã€‚åˆšå¼€å§‹å¯èƒ½ä¼šè§‰å¾—å®ƒçš„ç´¢å¼•ä»1å¼€å§‹å¾ˆå¥‡æ€ªï¼Œæ²¡æœ‰ç±»çš„æ¦‚å¿µè®©äººå›°æƒ‘ï¼Œä½†ä¸€æ—¦ä½ é€‚åº”äº†å®ƒçš„æ€ç»´æ–¹å¼ï¼Œä½ å°±ä¼šçˆ±ä¸Šè¿™ç§ç®€æ´è€Œå¼ºå¤§çš„è¯­è¨€ã€‚

è®°ä½ï¼Œæˆä¸ºLuaé«˜æ‰‹çš„å…³é”®ä¸æ˜¯è®°ä½æ‰€æœ‰è¯­æ³•ï¼Œè€Œæ˜¯ç†è§£å®ƒçš„å“²å­¦ï¼š**ç®€å•ã€çµæ´»ã€é«˜æ•ˆ**ã€‚æ­£å¦‚Luaä¹‹çˆ¶æ‰€è¯´ï¼š"**Lua is not a language for writing big programs, but a language for making big programs smaller.**"

åœ¨æ¸¸æˆå¼€å‘çš„å¹¿é˜”å¤©åœ°ä¸­ï¼ŒLuaæ˜¯ä½ æ‰‹ä¸­çš„ä¸€æŠŠç‘å£«å†›åˆ€ã€‚å®ƒå¯èƒ½ä¸æ˜¯æœ€é”‹åˆ©çš„ï¼Œä¹Ÿä¸æ˜¯æœ€èŠ±å“¨çš„ï¼Œä½†åœ¨å…³é”®æ—¶åˆ»ï¼Œå®ƒæ€»èƒ½å¸®ä½ è§£å†³é—®é¢˜ï¼Œè®©ä½ çš„æ¸¸æˆä¸–ç•Œæ›´åŠ ä¸°å¯Œå¤šå½©ã€‚

ç°åœ¨ï¼Œæ‹¿èµ·ä½ çš„é”®ç›˜ï¼Œå¼€å§‹ä½ çš„Luaå†’é™©å§ï¼æœ‰ä»»ä½•é—®é¢˜ï¼Œéšæ—¶å›æ¥æŸ¥é˜…è¿™ä»½æŒ‡å—ã€‚Happy coding! ğŸ˜Š

> **ç»ˆææç¤º**ï¼šå½“ä½ åœ¨æ·±å¤œdebugæ—¶ï¼Œè®°ä½â€”â€”æ¯ä¸€ä¸ªbugéƒ½æ˜¯ç³»ç»Ÿåœ¨ç”¨å®ƒè‡ªå·±çš„æ–¹å¼å‘Šè¯‰ä½ ï¼š"ä½ å¤ªèœäº†ï¼Œä½†æˆ‘ä¼šç»™ä½ æˆé•¿çš„æœºä¼šã€‚" ğŸ’ª